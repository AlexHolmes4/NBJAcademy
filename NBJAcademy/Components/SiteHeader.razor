@implements IDisposable
@inject NavigationManager Navigation

<header class="site-header">
    <NavLink href="/" Match="NavLinkMatch.All" class="navbar-brand" @onclick="CloseMenu">
        <img src="images/nbjlogotransparant.png" alt="NBJ Academy Logo" class="navbar-brand" />
    </NavLink>
    <nav class="nav-menu">
        <a class="nav-menu-item @(IsActive("/about-us") ? "active" : "")" href="/about-us">About Us</a>
        <a class="nav-menu-item @(IsActive("/timetable") ? "active" : "")" href="/timetable">Timetable</a>
        <a class="nav-menu-item @(IsActive("/gallery") ? "active" : "")" href="/gallery">Gallery</a>
        <a class="nav-menu-item @(IsActive("/find-us") ? "active" : "")" href="/find-us">Find Us</a>
        <a class="nav-menu-item @(IsActive("/contact-us") ? "active" : "")" href="/contact-us">Contact Us</a>
    </nav>
    <button class="hamburger" @onclick="ToggleMenu" aria-label="Toggle navigation">
        &#9776;
    </button>
</header>

@if (menuOpen)
{
    <div class="menu-overlay slide-down">
        <nav class="overlay-nav">
            <a class="overlay-menu-item" href="/about-us" @onclick="CloseMenu">About Us</a>
            <a class="overlay-menu-item" href="/timetable" @onclick="CloseMenu">Timetable</a>
            <a class="overlay-menu-item" href="/gallery" @onclick="CloseMenu">Gallery</a>
            <a class="overlay-menu-item" href="/find-us" @onclick="CloseMenu">Find Us</a>
            <a class="overlay-menu-item" href="/contact-us" @onclick="CloseMenu">Contact Us</a>
        </nav>
    </div>
}

@code {
    private bool menuOpen = false;

    private void ToggleMenu() => menuOpen = !menuOpen;
    private void CloseMenu() => menuOpen = false;

    protected override void OnInitialized()
    {
        Navigation.LocationChanged += OnLocationChanged;
    }

    private void OnLocationChanged(object? sender, Microsoft.AspNetCore.Components.Routing.LocationChangedEventArgs e)
    {
        StateHasChanged();
    }

    public void Dispose()
    {
        Navigation.LocationChanged -= OnLocationChanged;
    }

    private bool IsActive(string href)
    {
        var uri = "/" + Navigation.ToBaseRelativePath(Navigation.Uri).TrimEnd('/');
        return uri.Equals(href, StringComparison.OrdinalIgnoreCase);
    }
}